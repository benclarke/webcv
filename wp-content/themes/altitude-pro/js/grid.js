jQuery(document).ready(function(i){var t,e,s=i.event;t=s.special.debouncedresize={setup:function(){i(this).on("resize",t.handler)},teardown:function(){i(this).off("resize",t.handler)},handler:function(i,n){var h=this,a=arguments,o=function(){i.type="debouncedresize",s.dispatch.apply(h,a)};e&&clearTimeout(e),n?o():e=setTimeout(o,t.threshold)},threshold:250};var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.fn.imagesLoaded=function(t){function e(){var e=i(c),s=i(g);a&&(g.length?a.reject(r,e,s):a.resolve(r)),i.isFunction(t)&&t.call(h,r,e,s)}function s(t,s){t.src!==n&&-1===i.inArray(t,d)&&(d.push(t),s?g.push(t):c.push(t),i.data(t,"imagesLoaded",{isBroken:s,src:t.src}),o&&a.notifyWith(i(t),[s,r,i(c),i(g)]),r.length===d.length&&(setTimeout(e),r.unbind(".imagesLoaded")))}var h=this,a=i.isFunction(i.Deferred)?i.Deferred():0,o=i.isFunction(a.notify),r=h.find("img").add(h.filter("img")),d=[],c=[],g=[];return i.isPlainObject(t)&&i.each(t,function(i,e){"callback"===i?t=e:a&&a[i](e)}),r.length?r.bind("load.imagesLoaded error.imagesLoaded",function(i){s(i.target,"error"===i.type)}).each(function(t,e){var h=e.src,a=i.data(e,"imagesLoaded");return a&&a.src===h?void s(e,a.isBroken):e.complete&&void 0!==e.naturalWidth?void s(e,0===e.naturalWidth||0===e.naturalHeight):void((e.readyState||e.complete)&&(e.src=n,e.src=h))}):e(),a?a.promise(h):h};var h=function(){function t(t){T=i.extend(!0,{},T,t),g.imagesLoaded(function(){s(!0),a(),n()})}function e(t){l=l.add(t),t.each(function(){var t=i(this);t.data({offsetTop:t.offset().top,height:t.height()})}),h(t)}function s(t){l.each(function(){var e=i(this);e.data("offsetTop",e.offset().top),t&&e.data("height",e.height())})}function n(){h(l),v.on("debouncedresize",function(){u=0,p=-1,s(),a();var t=i.data(this,"preview");"undefined"!=typeof t&&r()})}function h(t){t.on("click","span.og-close",function(){return r(),!1}).children("a").on("click",function(t){var e=i(this).parent();return f===e.index()?r():o(e),!1})}function a(){c={width:v.width(),height:v.height()}}function o(t){var e=i.data(this,"preview"),s=t.data("offsetTop");if(u=0,"undefined"!=typeof e){if(p===s)return e.update(t),!1;s>p&&(u=e.height),r()}p=s,e=i.data(this,"preview",new d(t)),e.open()}function r(){f=-1;var t=i.data(this,"preview");t.close(),i.removeData(this,"preview")}function d(i){this.$item=i,this.expandedIdx=this.$item.index(),this.create(),this.update()}var c,g=i("#og-grid"),l=g.children("li"),f=-1,p=-1,u=0,m=10,v=i(window),$=i("html, body"),w={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},A=w[Modernizr.prefixed("transition")],x=Modernizr.csstransitions,T={minHeight:300,speed:350,easing:"ease"};return d.prototype={create:function(){this.$title=i("<h3></h3>"),this.$description=i('<div class="portfolio-text"></div>'),this.$href=i('<a href="#">Visit website</a>'),this.$details=i('<div class="og-details"></div>').append(this.$title,this.$description,this.$href),this.$loading=i('<div class="og-loading"></div>'),this.$fullimage=i('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=i('<span class="og-close"></span>'),this.$previewInner=i('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$details),this.$previewEl=i('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),x&&this.setTransition()},update:function(t){t&&(this.$item=t);var e=this.$item.children("a"),s={href:e.attr("href"),largesrc:e.data("largesrc"),title:e.data("title"),description:e.data("description")};if(this.$title.html(s.title),this.$description.html(s.description),s.href?this.$href.attr("href",s.href):this.$href.remove(),-1!==f){var n=l.eq(f);n.removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.height=this.$description.outerHeight(!0)+this.$title.outerHeight(!0),this.itemHeight=this.height+this.$item.data("height"),l.eq(this.expandedIdx).css("height",this.itemHeight),this.$previewEl.css("height",this.height),this.positionPreview()}f=this.$item.index();var h=this;"undefined"!=typeof h.$largeImg&&h.$largeImg.remove(),h.$fullimage.is(":visible")&&(this.$loading.show(),i("<img/>").load(function(){var t=i(this);t.attr("src")===h.$item.children("a").data("largesrc")&&(h.$loading.hide(),h.$fullimage.find("img").remove(),h.$largeImg=t.fadeIn(350),h.$fullimage.append(h.$largeImg))}).attr("src",s.largesrc))},open:function(){setTimeout(i.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var t=this,e=function(){x&&i(this).off(A),t.$item.removeClass("og-expanded"),t.$previewEl.remove()};return setTimeout(i.proxy(function(){"undefined"!=typeof this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var i=l.eq(this.expandedIdx);i.css("height",i.data("height")).on(A,e),x||e.call()},this),25),!1},calcHeight:function(){var i=this.$item.find(".portfolio-text").outerHeight(!0)+this.$item.find("h3").outerHeight(!0),t=i+this.$item.data("height");i<T.minHeight&&(i=T.minHeight,t=T.minHeight+this.$item.data("height")+m),this.height=i,console.log("preview height: "+i),this.itemHeight=t,console.log("item height: "+t)},setHeights:function(){var i=this,t=function(){x&&i.$item.off(A),i.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(A,t),x||t.call()},positionPreview:function(){var i=this.$item.data("offsetTop"),t=this.$previewEl.offset().top-u,e=this.height+this.$item.data("height")+m<=c.height?i:this.height<c.height?t-(c.height-this.height):t;$.animate({scrollTop:e},T.speed)},setTransition:function(){this.$previewEl.css("transition","height "+T.speed+"ms "+T.easing),this.$item.css("transition","height "+T.speed+"ms "+T.easing)},getEl:function(){return this.$previewEl}},{init:t,addItems:e}}();i(function(){h.init()})});